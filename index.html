<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Light-Run</title>
    
   <link rel="stylesheet" href="style.css">

   <style>
     body {
       margin-bottom: 130px;
     }
     iframe#audioPlayer {
       position: fixed;
       bottom: 0;
       left: 0;
       right: 0;
       margin: 0 auto;
       width: 100%;
       max-width: none;
       height: 100px;
       border: none;
       border-top-left-radius: 20px;
       border-top-right-radius: 20px;
       border-bottom-left-radius: 0;
       border-bottom-right-radius: 0;
       box-shadow: 0 -4px 20px rgba(0,0,0,0.6);
       z-index: 9999;
     }

    /* Player CSS from player.html */
    .player {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px 20px;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.6);
      z-index: 9999;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }
    #seekbar {
      width: 100%;
      height: 8px;
      background: #444;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 10px;
      position: relative;
    }
    #seekbar .progress {
      background: #1db954;
      height: 100%;
      width: 0%;
      border-radius: 4px;
    }
    .controls {
      display: flex;
      align-items: center;
      width: 100%;
      max-width: 600px;
      justify-content: space-between;
    }
    .buttons {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    button {
      background: none;
      border: none;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    button:hover {
      color: #1db954;
    }
    .volume-container {
      display: flex;
      align-items: center;
      gap: 5px;
      color: #fff;
    }
    input[type="range"] {
      -webkit-appearance: none;
      width: 100px;
      height: 5px;
      background: #444;
      border-radius: 5px;
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 15px;
      height: 15px;
      background: #1db954;
      cursor: pointer;
      border-radius: 50%;
      border: none;
      margin-top: -5px;
    }
    input[type="range"]::-moz-range-thumb {
      width: 15px;
      height: 15px;
      background: #1db954;
      cursor: pointer;
      border-radius: 50%;
      border: none;
    }
    .track-info {
      color: #fff;
      font-size: 14px;
      text-align: center;
      margin-bottom: 5px;
      width: 100%;
      max-width: 600px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis; 
     
    }
   </style>

</head>
<body>
   <!-- PLAYER PERSISTENTE -->
  <div class="player">
    <div id="seekbar"><div class="progress"></div></div>
    <div class="track-info" id="trackInfo">Loading...</div>
    <div class="controls">
      <div class="buttons">
        <button id="prevBtn" title="Previous Track">&#9664;&#9664;</button>
        <button id="playPauseBtn" title="Play/Pause">&#9654;</button>
        <button id="nextBtn" title="Next Track">&#9654;&#9654;</button>
        <button id="muteBtn" title="Mute/Unmute">&#128266;</button>
      </div>
      <select id="trackSelector"></select>
      <div class="volume-container">
        <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5" />
      </div>
    </div>
    <audio id="audio"></audio>
  </div>

  <div data-barba="wrapper">
      <div data-barba="container" data-barba-namespace="home">
          <header>
      <h1>DELTARUNE</h1>
          </header>
      <h2> Welcome Back Fellow Lightners</h2>
      <br>
      <br>
      <a class="a2" href="La Profezia.html"> La Profezia</a>
      <br>
      <br>
      <a class="a2" href="Plotprincipale.html"> Plot Principale </a>
      <br>
      <br>
      <a class="a2" href="BossOpzionali.html">I superboss</a>
      <br>
      <br>
      <a class="a2" href="snowgrave.html">Diventare piu' forti</a>
       <br>
      <br>
      <a class="a2" href="dettagli.html">I Dettagli</a>   
       <br>
      <br>
      <a class="a2" href="crediti.html">Crediti</a>
      </div>
  </div>

    <script src="https://unpkg.com/@barba/core"></script>

    <script src="https://unpkg.com/gsap@latest/dist/gsap.min.js"></script>

    <!-- init barba with a simple opacity transition -->
    <script type="text/javascript">
      barba.init({
        transitions: [{
          name: 'opacity-transition',
          leave(data) {
            return gsap.to(data.current.container, {
              opacity: 0
            });
          },
          enter(data) {
            return gsap.from(data.next.container, {
              opacity: 0
            });
          },
          once(data) {
            return gsap.from(data.next.container, {
              opacity: 0
            });
          }
        }],
      });
    </script>
    <script>
    // Se la pagina viene caricata direttamente (refresh su pagina interna), reindirizza alla home
    document.addEventListener('DOMContentLoaded', () => {
      const barbaContainer = document.querySelector('[data-barba="container"]');
      const isIndex = window.location.pathname.endsWith('index.html') || window.location.pathname.endsWith('/');

      if (!isIndex && (!barbaContainer || !barba.history.previous)) {
        window.location.href = 'index.html';
      }
    });
  </script>

  <script>
    const audio = document.getElementById('audio');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const muteBtn = document.getElementById('muteBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    const seekbar = document.getElementById('seekbar');
    const progress = seekbar.querySelector('.progress');
    const trackInfo = document.getElementById('trackInfo');

    const tracks = [
        {title: "1. Beginning", src: "audio/1_Beginning.mp3"},
        {title: "2. School", src: "audio/2_School.mp3"},
        {title: "3. The Legend", src: "audio/3_The_Legend.mp3"},
        {title: "4. Lancer", src: "audio/4_Lancer.mp3"},
        {title: "5. Rude Buster", src: "audio/5_RudeBuster.mp3"},
        {title: "6. Empty Town", src: "audio/6_EmptyTown.mp3"},
        {title: "7. Field of Hopes and Dreams", src: "audio/7_Field_of_Hopes_and_Dreams.mp3"},
        {title: "8. Lantern", src: "audio/8_Lantern.mp3"},
        {title: "9. Checker Dance", src: "audio/9_Checker_Dance.mp3"},
        {title: "10. Scarlet Forest", src: "audio/10_Scarlet_Forest.mp3"},
        {title: "11. Thrash Machine", src: "audio/11_Thrash_Machine.mp3"},
        {title: "12. Vs. Susie", src: "audio/12_Vs.Susie.mp3"},
        {title: "13. Chaos King", src: "audio/13_Chaos_King.mp3"},
        {title: "14. Darkness Falls", src: "audio/14_Darkness_Falls.mp3"},
        {title: "15. THE WORLD REVOLVING", src: "audio/world.mp3"},
        {title: "16. Friendship", src: "audio/16_Friendship.mp3"},
        {title: "17. His Shop", src: "audio/His_Shop.mp3"},
        {title: "18. It's Raining Somewhere Else", src: "audio/rain.mp3"},
        { title: "19. My Castle Town", src: "audio/1.03 Toby Fox - DELTARUNE Chapter 2 OST - 03 My Castle Town.mp3" },
        { title: "20. A CYBER'S WORLD", src: "audio/1.06 Toby Fox - DELTARUNE Chapter 2 OST - 06 A CYBER'S WORLD-.mp3" },
        { title: "21. Smart Race", src: "audio/1.15 Toby Fox - DELTARUNE Chapter 2 OST - 15 Smart Race.mp3" },
        { title: "22. WELCOME TO THE CITY", src: "audio/1.17 Toby Fox - DELTARUNE Chapter 2 OST - 17 WELCOME TO THE CITY.mp3" },
        { title: "23. Spamton", src: "audio/1.22 Toby Fox - DELTARUNE Chapter 2 OST - 22 Spamton.mp3" },
        { title: "24. NOW'S YOUR CHANCE TO BE A", src: "audio/1.23 Toby Fox - DELTARUNE Chapter 2 OST - 23 NOW'S YOUR CHANCE TO BE A.mp3" },
        { title: "25. Pandora Palace", src: "audio/1.26 Toby Fox - DELTARUNE Chapter 2 OST - 26 Pandora Palace.mp3" },
        { title: "26. It's Pronounced -Rules-", src: "audio/1.29 Toby Fox - DELTARUNE Chapter 2 OST - 29 It's Pronounced -Rules-.mp3" },
        { title: "27. Lost Girl", src: "audio/1.30 Toby Fox - DELTARUNE Chapter 2 OST - 30 Lost Girl.mp3" },
        { title: "28. Ferris Wheel", src: "audio/1.31 Toby Fox - DELTARUNE Chapter 2 OST - 31 Ferris Wheel.mp3" },
        { title: "29. Attack of the Killer Queen", src: "audio/32 - Toby Fox - Attack of the Killer Queen.mp3" },
        { title: "30. Knock You Down !!", src: "audio/1.35 Toby Fox - DELTARUNE Chapter 2 OST - 35 Knock You Down !!.mp3" },
        { title: "31. BIG SHOT", src: "audio/1.39 Toby Fox - DELTARUNE Chapter 2 OST - 39 BIG SHOT.mp3" },
        { title: "32. You Can Always Come Home", src: "audio/1.44 Toby Fox - DELTARUNE Chapter 2 OST - 44 You Can Always Come Home.mp3" }


    ];

    const trackSelector = document.getElementById('trackSelector');
    tracks.forEach((t, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = t.title;
      trackSelector.appendChild(opt);
    });
    trackSelector.addEventListener('change', () => {
      loadTrack(parseInt(trackSelector.value));
      playPause();
    });

    let currentTrackIndex = 0;
    let isPlaying = false;
    let isMuted = false;

    function loadTrack(index) {
      if (index < 0) index = tracks.length - 1;
      if (index >= tracks.length) index = 0;
      currentTrackIndex = index;
      audio.src = tracks[currentTrackIndex].src;
      trackInfo.textContent = tracks[currentTrackIndex].title;
      localStorage.setItem('currentTrackIndex', currentTrackIndex);
      trackSelector.value = currentTrackIndex;
      if (isPlaying) {
        audio.play();
      }
    }

    function playPause() {
      if (audio.paused) {
        audio.play();
        isPlaying = true;
        playPauseBtn.innerHTML = "&#10073;&#10073;"; // Icona pausa
      } else {
        audio.pause();
        isPlaying = false;
        playPauseBtn.innerHTML = "&#9654;"; // Icona play
      }
    }

    function nextTrack() {
      loadTrack(currentTrackIndex + 1);
      audio.play();
      isPlaying = true;
      playPauseBtn.innerHTML = "&#10073;&#10073;";
    }

    function prevTrack() {
      loadTrack(currentTrackIndex - 1);
      audio.play();
      isPlaying = true;
      playPauseBtn.innerHTML = "&#10073;&#10073;";
    }

    function updateProgress() {
      const percent = (audio.currentTime / audio.duration) * 100;
      progress.style.width = percent + '%';
    }

    function seek(e) {
      const rect = seekbar.getBoundingClientRect();
      const offsetX = e.clientX - rect.left;
      const percent = offsetX / rect.width;
      audio.currentTime = percent * audio.duration;
    }

    function toggleMute() {
      isMuted = !isMuted;
      audio.muted = isMuted;
      muteBtn.innerHTML = isMuted ? "&#128263;" : "&#128266;";
      localStorage.setItem('isMuted', isMuted);
    }

    function changeVolume() {
      audio.volume = volumeSlider.value;
      if(audio.volume === 0){
        isMuted = true;
        audio.muted = true;
        muteBtn.innerHTML = "&#128263;";
      } else {
        isMuted = false;
        audio.muted = false;
        muteBtn.innerHTML = "&#128266;";
      }
      localStorage.setItem('volume', audio.volume);
      localStorage.setItem('isMuted', isMuted);
    }

    // Load saved settings
    window.onload = () => {
      const savedTrack = localStorage.getItem('currentTrackIndex');
      if(savedTrack !== null){
        currentTrackIndex = parseInt(savedTrack);
      }
      const savedVolume = localStorage.getItem('volume');
      if(savedVolume !== null){
        audio.volume = savedVolume;
        volumeSlider.value = savedVolume;
      } else {
        audio.volume = 0.5;
        volumeSlider.value = 0.5;
      }
      const savedMuted = localStorage.getItem('isMuted');
      if(savedMuted !== null){
        isMuted = (savedMuted === 'true');
        audio.muted = isMuted;
        muteBtn.innerHTML = isMuted ? "&#128263;" : "&#128266;";
      }
      loadTrack(currentTrackIndex);
      trackSelector.value = currentTrackIndex;
    };

    playPauseBtn.addEventListener('click', playPause);
    nextBtn.addEventListener('click', nextTrack);
    prevBtn.addEventListener('click', prevTrack);
    muteBtn.addEventListener('click', toggleMute);
    volumeSlider.addEventListener('input', changeVolume);
    audio.addEventListener('timeupdate', updateProgress);
    seekbar.addEventListener('click', seek);
    audio.addEventListener('ended', () => {
      isPlaying = true;
      nextTrack();
    });
  </script>
  <script>
    // Blocca refresh con F5 o Ctrl/Cmd + R
    window.addEventListener('keydown', function (e) {
      if (e.key === 'F5') {
        e.preventDefault();
      }
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'r') {
        e.preventDefault();
      }
    });
  </script>
  </body>
</html>



